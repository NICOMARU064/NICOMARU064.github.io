<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>板版掲示板</title>
<style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; }
    header { background: #4CAF50; color: white; padding: 10px; text-align: center; }
    main { max-width: 600px; margin: 20px auto; background: white; padding: 20px; border-radius: 8px; }
    form { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
    input, textarea, button { padding: 10px; font-size: 1rem; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #4CAF50; color: white; cursor: pointer; border: none; }
    button:hover { background: #45a049; }
    .post { border-bottom: 1px solid #ddd; padding: 10px 0; }
    .name { font-weight: bold; }
    .time { font-size: 0.8rem; color: gray; }
</style>
</head>
<body>

<header>
    <h1>板版掲示板</h1>
</header>

<main>
    <!-- 新規登録フォーム -->
    <form id="registerForm">
        <h3>新規登録</h3>
        <input type="email" id="regEmail" placeholder="メールアドレス" required>
        <input type="password" id="regPassword" placeholder="パスワード" required>
        <button type="submit">登録</button>
    </form>

    <!-- ログインフォーム -->
    <form id="loginForm">
        <h3>ログイン</h3>
        <input type="email" id="loginEmail" placeholder="メールアドレス" required>
        <input type="password" id="loginPassword" placeholder="パスワード" required>
        <button type="submit">ログイン</button>
    </form>

    <!-- ログアウトボタン -->
    <button id="logoutBtn" style="display:none;">ログアウト</button>
    <p id="userInfo"></p>

    <!-- 投稿フォーム（ログイン時のみ表示） -->
    <form id="postForm" style="display:none;">
        <textarea id="message" placeholder="メッセージ" rows="3" required></textarea>
        <button type="submit">投稿</button>
    </form>

    <div id="posts"></div>
</main>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
        from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";

    // Firebase設定（あなたのプロジェクトに置き換え）
    const firebaseConfig = {
        apiKey: "AIzaSyCrnB7-oE9mp3-NYpKMjz_Gl2c2bqrV_Jg",
        authDomain: "itabankeijiban.firebaseapp.com",
        projectId: "itabankeijiban",
        storageBucket: "itabankeijiban.firebasestorage.app",
        messagingSenderId: "27830504530",
        appId: "1:27830504530:web:4d05efde1ced2aac3b638b"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const registerForm = document.getElementById('registerForm');
    const loginForm = document.getElementById('loginForm');
    const logoutBtn = document.getElementById('logoutBtn');
    const userInfo = document.getElementById('userInfo');
    const postForm = document.getElementById('postForm');
    const postsDiv = document.getElementById('posts');

    // 新規登録
    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('regEmail').value;
        const password = document.getElementById('regPassword').value;
        try {
            await createUserWithEmailAndPassword(auth, email, password);
            alert("登録完了！ログインしました");
        } catch (error) {
            alert("登録エラー: " + error.message);
        }
    });

    // ログイン
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        try {
            await signInWithEmailAndPassword(auth, email, password);
            alert("ログイン成功");
        } catch (error) {
            alert("ログインエラー: " + error.message);
        }
    });

    // ログアウト
    logoutBtn.addEventListener('click', async () => {
        await signOut(auth);
    });

    // 認証状態の監視
    onAuthStateChanged(auth, (user) => {
        if (user) {
            userInfo.textContent = `ログイン中: ${user.email}`;
            logoutBtn.style.display = "block";
            postForm.style.display = "flex";
            loginForm.style.display = "none";
            registerForm.style.display = "none";
        } else {
            userInfo.textContent = "";
            logoutBtn.style.display = "none";
            postForm.style.display = "none";
            loginForm.style.display = "flex";
            registerForm.style.display = "flex";
        }
    });

    // 投稿送信
    postForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const message = document.getElementById('message').value.trim();
        if (!message) return;
        const user = auth.currentUser;
        if (!user) return alert("ログインしてください");

        await addDoc(collection(db, "posts"), {
            name: user.email,
            message,
            created_at: serverTimestamp()
        });

        postForm.reset();
    });

    // 投稿一覧リアルタイム取得
    const q = query(collection(db, "posts"), orderBy("created_at", "desc"));
    onSnapshot(q, (snapshot) => {
        postsDiv.innerHTML = '';
        snapshot.forEach((doc) => {
            const post = doc.data();
            const div = document.createElement('div');
            div.className = 'post';
            div.innerHTML = `
