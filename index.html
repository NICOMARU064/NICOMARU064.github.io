<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>シンプル掲示板（ログインなし）</title>
<style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; margin: 0; }
    header { background: #4CAF50; color: white; padding: 10px; text-align: center; }
    main { max-width: 600px; margin: 20px auto; background: white; padding: 20px; border-radius: 8px; }
    form { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; }
    input, textarea, button { padding: 10px; font-size: 1rem; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #4CAF50; color: white; cursor: pointer; border: none; }
    button:hover { background: #45a049; }
    .post { border-bottom: 1px solid #ddd; padding: 10px 0; }
    .name { font-weight: bold; }
    .time { font-size: 0.8rem; color: gray; }
</style>
</head>
<body>

<header>
    <h1>シンプル掲示板</h1>
</header>

<main>
    <!-- 投稿フォーム -->
    <form id="postForm">
        <input type="text" id="name" placeholder="名前" required>
        <textarea id="message" placeholder="メッセージ" rows="3" required></textarea>
        <button type="submit">投稿</button>
    </form>

    <!-- 投稿一覧 -->
    <div id="posts"></div>
</main>

<script type="module">
    // Firebase SDK モジュール版を読み込み
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp } 
        from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    // Firebase 設定（あなたのプロジェクトに置き換え）
    const firebaseConfig = {
        apiKey: "AIzaSyCrnB7-oE9mp3-NYpKMjz_Gl2c2bqrV_Jg",
        authDomain: "itabankeijiban.firebaseapp.com",
        projectId: "itabankeijiban",
        storageBucket: "itabankeijiban.appspot.com", // ← 修正版
        messagingSenderId: "27830504530",
        appId: "1:27830504530:web:4d05efde1ced2aac3b638b",
        measurementId: "G-371FGCTGFT"
    };

    // Firebase 初期化
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const form = document.getElementById('postForm');
    const postsDiv = document.getElementById('posts');

    // 投稿送信
    form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const name = document.getElementById('name').value.trim();
        const message = document.getElementById('message').value.trim();
        if (!name || !message) return;

        await addDoc(collection(db, "posts"), {
            name,
            message,
            created_at: serverTimestamp()
        });

        form.reset();
    });

    // 投稿一覧リアルタイム取得
    const q = query(collection(db, "posts"), orderBy("created_at", "desc"));
    onSnapshot(q, (snapshot) => {
        postsDiv.innerHTML = '';
        snapshot.forEach((doc) => {
            const post = doc.data();
            const div = document.createElement('div');
            div.className = 'post';
            div.innerHTML = `
                <div class="name">${post.name}</div>
                <div class="time">${post.created_at?.toDate().toLocaleString() || ''}</div>
                <div class="message">${post.message}</div>
            `;
            postsDiv.appendChild(div);
        });
    });
</script>

</body>
</html>
